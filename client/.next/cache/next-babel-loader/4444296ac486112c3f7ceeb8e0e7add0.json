{"ast":null,"code":"var _jsxFileName = \"/usr/src/app/utils/auth/auth.tsx\";\nvar __jsx = React.createElement;\nfunction _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\nimport Router from \"next/router\";\nimport React, { Component } from \"react\";\nimport { redirectToLogin } from \"./redirect\";\nimport nookies from \"nookies\";\nimport Cookies from \"js-cookie\";\nexport const TOKEN_STORAGE_NAME = \"app.authToken\";\nexport function login(token) {\n  nookies.set(null, TOKEN_STORAGE_NAME, token, {\n    maxAge: 7 * 24 * 60 * 60,\n    path: \"/\"\n  });\n  Router.push(\"/\");\n}\nexport function logout() {\n  Cookies.remove(TOKEN_STORAGE_NAME, {\n    path: \"/\"\n  });\n  // to support logging out from all windows\n  window.localStorage.setItem(\"logout\", Date.now().toString());\n}\nexport function withAuth(WrappedComponent) {\n  return class AuthWrapper extends Component {\n    static async getInitialProps(ctx, props) {\n      const {\n        auth\n      } = props;\n      if (!auth || auth && auth.isExpired) {\n        redirectToLogin(ctx.res);\n      }\n      const initialProps = {\n        auth\n      };\n      if (WrappedComponent.getInitialProps) {\n        return WrappedComponent.getInitialProps(ctx, initialProps);\n      }\n      return initialProps;\n    }\n    render() {\n      return __jsx(WrappedComponent, _extends({}, this.props, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 44,\n          columnNumber: 14\n        }\n      }));\n    }\n  };\n}","map":{"version":3,"names":["Router","React","Component","redirectToLogin","nookies","Cookies","TOKEN_STORAGE_NAME","login","token","set","maxAge","path","push","logout","remove","window","localStorage","setItem","Date","now","toString","withAuth","WrappedComponent","AuthWrapper","getInitialProps","ctx","props","auth","isExpired","res","initialProps","render","__jsx","_extends","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber"],"sources":["/usr/src/app/utils/auth/auth.tsx"],"sourcesContent":["import Router from \"next/router\";\r\nimport { NextPageContext } from \"next\";\r\nimport React, { Component } from \"react\";\r\nimport { AuthToken } from \"./auth-token\";\r\nimport { redirectToLogin } from \"./redirect\";\r\nimport nookies from \"nookies\";\r\nimport Cookies from \"js-cookie\";\r\n\r\nexport const TOKEN_STORAGE_NAME = \"app.authToken\";\r\n\r\nexport function login(token: string) {\r\n  nookies.set(null, TOKEN_STORAGE_NAME, token, {\r\n    maxAge: 7 * 24 * 60 * 60,\r\n    path: \"/\",\r\n  });\r\n  Router.push(\"/\");\r\n}\r\n\r\nexport function logout() {\r\n  Cookies.remove(TOKEN_STORAGE_NAME, { path: \"/\" });\r\n  // to support logging out from all windows\r\n  window.localStorage.setItem(\"logout\", Date.now().toString());\r\n}\r\n\r\nexport type AuthProps = {\r\n  auth: AuthToken;\r\n};\r\n\r\nexport function withAuth(WrappedComponent: any) {\r\n  return class AuthWrapper extends Component<AuthProps> {\r\n    static async getInitialProps(ctx: NextPageContext, props: AuthProps) {\r\n      const { auth } = props;\r\n      if (!auth || (auth && auth.isExpired)) {\r\n        redirectToLogin(ctx.res);\r\n      }\r\n      const initialProps = { auth };\r\n      if (WrappedComponent.getInitialProps) {\r\n        return WrappedComponent.getInitialProps(ctx, initialProps);\r\n      }\r\n      return initialProps;\r\n    }\r\n\r\n    render() {\r\n      return <WrappedComponent {...this.props} />;\r\n    }\r\n  };\r\n}\r\n"],"mappings":";;;AAAA,OAAOA,MAAM,MAAM,aAAa;AAEhC,OAAOC,KAAK,IAAIC,SAAS,QAAQ,OAAO;AAExC,SAASC,eAAe,QAAQ,YAAY;AAC5C,OAAOC,OAAO,MAAM,SAAS;AAC7B,OAAOC,OAAO,MAAM,WAAW;AAE/B,OAAO,MAAMC,kBAAkB,GAAG,eAAe;AAEjD,OAAO,SAASC,KAAKA,CAACC,KAAa,EAAE;EACnCJ,OAAO,CAACK,GAAG,CAAC,IAAI,EAAEH,kBAAkB,EAAEE,KAAK,EAAE;IAC3CE,MAAM,EAAE,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE;IACxBC,IAAI,EAAE;EACR,CAAC,CAAC;EACFX,MAAM,CAACY,IAAI,CAAC,GAAG,CAAC;AAClB;AAEA,OAAO,SAASC,MAAMA,CAAA,EAAG;EACvBR,OAAO,CAACS,MAAM,CAACR,kBAAkB,EAAE;IAAEK,IAAI,EAAE;EAAI,CAAC,CAAC;EACjD;EACAI,MAAM,CAACC,YAAY,CAACC,OAAO,CAAC,QAAQ,EAAEC,IAAI,CAACC,GAAG,CAAC,CAAC,CAACC,QAAQ,CAAC,CAAC,CAAC;AAC9D;AAMA,OAAO,SAASC,QAAQA,CAACC,gBAAqB,EAAE;EAC9C,OAAO,MAAMC,WAAW,SAASrB,SAAS,CAAY;IACpD,aAAasB,eAAeA,CAACC,GAAoB,EAAEC,KAAgB,EAAE;MACnE,MAAM;QAAEC;MAAK,CAAC,GAAGD,KAAK;MACtB,IAAI,CAACC,IAAI,IAAKA,IAAI,IAAIA,IAAI,CAACC,SAAU,EAAE;QACrCzB,eAAe,CAACsB,GAAG,CAACI,GAAG,CAAC;MAC1B;MACA,MAAMC,YAAY,GAAG;QAAEH;MAAK,CAAC;MAC7B,IAAIL,gBAAgB,CAACE,eAAe,EAAE;QACpC,OAAOF,gBAAgB,CAACE,eAAe,CAACC,GAAG,EAAEK,YAAY,CAAC;MAC5D;MACA,OAAOA,YAAY;IACrB;IAEAC,MAAMA,CAAA,EAAG;MACP,OAAOC,KAAA,CAACV,gBAAgB,EAAAW,QAAA,KAAK,IAAI,CAACP,KAAK;QAAAQ,MAAA;QAAAC,QAAA;UAAAC,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA;MAAA,EAAG,CAAC;IAC7C;EACF,CAAC;AACH","ignoreList":[]},"metadata":{},"sourceType":"module"}