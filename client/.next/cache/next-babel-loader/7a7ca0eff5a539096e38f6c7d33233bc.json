{"ast":null,"code":"var _jsxFileName = \"/home/maram/Desktop/1testpfa11/flask-nextjs-user-management-example2.0/client/utils/auth/auth.tsx\";\nvar __jsx = React.createElement;\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport Router from \"next/router\";\nimport React, { Component } from \"react\";\nimport { redirectToLogin } from \"./redirect\";\nimport nookies from \"nookies\";\nimport Cookies from \"js-cookie\";\nexport const TOKEN_STORAGE_NAME = \"app.authToken\";\nexport function login(token) {\n  nookies.set(null, TOKEN_STORAGE_NAME, token, {\n    maxAge: 7 * 24 * 60 * 60,\n    path: \"/\"\n  });\n  Router.push(\"/\");\n}\nexport function logout() {\n  Cookies.remove(TOKEN_STORAGE_NAME, {\n    path: \"/\"\n  }); // to support logging out from all windows\n\n  window.localStorage.setItem(\"logout\", Date.now().toString());\n}\nexport function withAuth(WrappedComponent) {\n  return class AuthWrapper extends Component {\n    static async getInitialProps(ctx, props) {\n      const {\n        auth\n      } = props;\n\n      if (!auth || auth && auth.isExpired) {\n        redirectToLogin(ctx.res);\n      }\n\n      const initialProps = {\n        auth\n      };\n\n      if (WrappedComponent.getInitialProps) {\n        return WrappedComponent.getInitialProps(ctx, initialProps);\n      }\n\n      return initialProps;\n    }\n\n    render() {\n      return __jsx(WrappedComponent, _extends({}, this.props, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 44,\n          columnNumber: 14\n        }\n      }));\n    }\n\n  };\n}","map":{"version":3,"sources":["/home/maram/Desktop/1testpfa11/flask-nextjs-user-management-example2.0/client/utils/auth/auth.tsx"],"names":["Router","React","Component","redirectToLogin","nookies","Cookies","TOKEN_STORAGE_NAME","login","token","set","maxAge","path","push","logout","remove","window","localStorage","setItem","Date","now","toString","withAuth","WrappedComponent","AuthWrapper","getInitialProps","ctx","props","auth","isExpired","res","initialProps","render"],"mappings":";;;;;AAAA,OAAOA,MAAP,MAAmB,aAAnB;AAEA,OAAOC,KAAP,IAAgBC,SAAhB,QAAiC,OAAjC;AAEA,SAASC,eAAT,QAAgC,YAAhC;AACA,OAAOC,OAAP,MAAoB,SAApB;AACA,OAAOC,OAAP,MAAoB,WAApB;AAEA,OAAO,MAAMC,kBAAkB,GAAG,eAA3B;AAEP,OAAO,SAASC,KAAT,CAAeC,KAAf,EAA8B;AACnCJ,EAAAA,OAAO,CAACK,GAAR,CAAY,IAAZ,EAAkBH,kBAAlB,EAAsCE,KAAtC,EAA6C;AAC3CE,IAAAA,MAAM,EAAE,IAAI,EAAJ,GAAS,EAAT,GAAc,EADqB;AAE3CC,IAAAA,IAAI,EAAE;AAFqC,GAA7C;AAIAX,EAAAA,MAAM,CAACY,IAAP,CAAY,GAAZ;AACD;AAED,OAAO,SAASC,MAAT,GAAkB;AACvBR,EAAAA,OAAO,CAACS,MAAR,CAAeR,kBAAf,EAAmC;AAAEK,IAAAA,IAAI,EAAE;AAAR,GAAnC,EADuB,CAEvB;;AACAI,EAAAA,MAAM,CAACC,YAAP,CAAoBC,OAApB,CAA4B,QAA5B,EAAsCC,IAAI,CAACC,GAAL,GAAWC,QAAX,EAAtC;AACD;AAMD,OAAO,SAASC,QAAT,CAAkBC,gBAAlB,EAAyC;AAC9C,SAAO,MAAMC,WAAN,SAA0BrB,SAA1B,CAA+C;AACpD,iBAAasB,eAAb,CAA6BC,GAA7B,EAAmDC,KAAnD,EAAqE;AACnE,YAAM;AAAEC,QAAAA;AAAF,UAAWD,KAAjB;;AACA,UAAI,CAACC,IAAD,IAAUA,IAAI,IAAIA,IAAI,CAACC,SAA3B,EAAuC;AACrCzB,QAAAA,eAAe,CAACsB,GAAG,CAACI,GAAL,CAAf;AACD;;AACD,YAAMC,YAAY,GAAG;AAAEH,QAAAA;AAAF,OAArB;;AACA,UAAIL,gBAAgB,CAACE,eAArB,EAAsC;AACpC,eAAOF,gBAAgB,CAACE,eAAjB,CAAiCC,GAAjC,EAAsCK,YAAtC,CAAP;AACD;;AACD,aAAOA,YAAP;AACD;;AAEDC,IAAAA,MAAM,GAAG;AACP,aAAO,MAAC,gBAAD,eAAsB,KAAKL,KAA3B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAP;AACD;;AAfmD,GAAtD;AAiBD","sourcesContent":["import Router from \"next/router\";\nimport { NextPageContext } from \"next\";\nimport React, { Component } from \"react\";\nimport { AuthToken } from \"./auth-token\";\nimport { redirectToLogin } from \"./redirect\";\nimport nookies from \"nookies\";\nimport Cookies from \"js-cookie\";\n\nexport const TOKEN_STORAGE_NAME = \"app.authToken\";\n\nexport function login(token: string) {\n  nookies.set(null, TOKEN_STORAGE_NAME, token, {\n    maxAge: 7 * 24 * 60 * 60,\n    path: \"/\",\n  });\n  Router.push(\"/\");\n}\n\nexport function logout() {\n  Cookies.remove(TOKEN_STORAGE_NAME, { path: \"/\" });\n  // to support logging out from all windows\n  window.localStorage.setItem(\"logout\", Date.now().toString());\n}\n\nexport type AuthProps = {\n  auth: AuthToken;\n};\n\nexport function withAuth(WrappedComponent: any) {\n  return class AuthWrapper extends Component<AuthProps> {\n    static async getInitialProps(ctx: NextPageContext, props: AuthProps) {\n      const { auth } = props;\n      if (!auth || (auth && auth.isExpired)) {\n        redirectToLogin(ctx.res);\n      }\n      const initialProps = { auth };\n      if (WrappedComponent.getInitialProps) {\n        return WrappedComponent.getInitialProps(ctx, initialProps);\n      }\n      return initialProps;\n    }\n\n    render() {\n      return <WrappedComponent {...this.props} />;\n    }\n  };\n}\n"]},"metadata":{},"sourceType":"module"}