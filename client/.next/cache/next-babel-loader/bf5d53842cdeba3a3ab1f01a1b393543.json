{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/home/maram/Desktop/1testpfa11/flask-nextjs-user-management-example2.0/client/utils/auth/auth.tsx\";\nvar __jsx = React.createElement;\n\nfunction _callSuper(_this, derived, args) {\n  function isNativeReflectConstruct() {\n    if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n    if (Reflect.construct.sham) return false;\n    if (typeof Proxy === \"function\") return true;\n\n    try {\n      return !Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n    } catch (e) {\n      return false;\n    }\n  }\n\n  derived = _getPrototypeOf(derived);\n  return _possibleConstructorReturn(_this, isNativeReflectConstruct() ? Reflect.construct(derived, args || [], _getPrototypeOf(_this).constructor) : derived.apply(_this, args));\n}\n\nimport Router from \"next/router\";\nimport React, { Component } from \"react\";\nimport { redirectToLogin } from \"./redirect\";\nimport nookies from \"nookies\";\nimport Cookies from \"js-cookie\";\nexport var TOKEN_STORAGE_NAME = \"app.authToken\";\nexport function login(token) {\n  nookies.set(null, TOKEN_STORAGE_NAME, token, {\n    maxAge: 7 * 24 * 60 * 60,\n    path: \"/\"\n  });\n  Router.push(\"/\");\n}\nexport function logout() {\n  Cookies.remove(TOKEN_STORAGE_NAME, {\n    path: \"/\"\n  }); // to support logging out from all windows\n\n  window.localStorage.setItem(\"logout\", Date.now().toString());\n}\nexport function withAuth(WrappedComponent) {\n  return /*#__PURE__*/function (_Component) {\n    function AuthWrapper() {\n      _classCallCheck(this, AuthWrapper);\n\n      return _callSuper(this, AuthWrapper, arguments);\n    }\n\n    _inherits(AuthWrapper, _Component);\n\n    return _createClass(AuthWrapper, [{\n      key: \"render\",\n      value: function render() {\n        return __jsx(WrappedComponent, _extends({}, this.props, {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 44,\n            columnNumber: 14\n          }\n        }));\n      }\n    }], [{\n      key: \"getInitialProps\",\n      value: function () {\n        var _getInitialProps = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(ctx, props) {\n          var auth, initialProps;\n          return _regeneratorRuntime.wrap(function _callee$(_context) {\n            while (1) switch (_context.prev = _context.next) {\n              case 0:\n                auth = props.auth;\n\n                if (!auth || auth && auth.isExpired) {\n                  redirectToLogin(ctx.res);\n                }\n\n                initialProps = {\n                  auth: auth\n                };\n\n                if (!WrappedComponent.getInitialProps) {\n                  _context.next = 5;\n                  break;\n                }\n\n                return _context.abrupt(\"return\", WrappedComponent.getInitialProps(ctx, initialProps));\n\n              case 5:\n                return _context.abrupt(\"return\", initialProps);\n\n              case 6:\n              case \"end\":\n                return _context.stop();\n            }\n          }, _callee);\n        }));\n\n        function getInitialProps(_x, _x2) {\n          return _getInitialProps.apply(this, arguments);\n        }\n\n        return getInitialProps;\n      }()\n    }]);\n  }(Component);\n}","map":{"version":3,"sources":["/home/maram/Desktop/1testpfa11/flask-nextjs-user-management-example2.0/client/utils/auth/auth.tsx"],"names":["Router","React","Component","redirectToLogin","nookies","Cookies","TOKEN_STORAGE_NAME","login","token","set","maxAge","path","push","logout","remove","window","localStorage","setItem","Date","now","toString","withAuth","WrappedComponent","props","ctx","auth","isExpired","res","initialProps","getInitialProps"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,OAAOA,MAAP,MAAmB,aAAnB;AAEA,OAAOC,KAAP,IAAgBC,SAAhB,QAAiC,OAAjC;AAEA,SAASC,eAAT,QAAgC,YAAhC;AACA,OAAOC,OAAP,MAAoB,SAApB;AACA,OAAOC,OAAP,MAAoB,WAApB;AAEA,OAAO,IAAMC,kBAAkB,GAAG,eAA3B;AAEP,OAAO,SAASC,KAAT,CAAeC,KAAf,EAA8B;AACnCJ,EAAAA,OAAO,CAACK,GAAR,CAAY,IAAZ,EAAkBH,kBAAlB,EAAsCE,KAAtC,EAA6C;AAC3CE,IAAAA,MAAM,EAAE,IAAI,EAAJ,GAAS,EAAT,GAAc,EADqB;AAE3CC,IAAAA,IAAI,EAAE;AAFqC,GAA7C;AAIAX,EAAAA,MAAM,CAACY,IAAP,CAAY,GAAZ;AACD;AAED,OAAO,SAASC,MAAT,GAAkB;AACvBR,EAAAA,OAAO,CAACS,MAAR,CAAeR,kBAAf,EAAmC;AAAEK,IAAAA,IAAI,EAAE;AAAR,GAAnC,EADuB,CAEvB;;AACAI,EAAAA,MAAM,CAACC,YAAP,CAAoBC,OAApB,CAA4B,QAA5B,EAAsCC,IAAI,CAACC,GAAL,GAAWC,QAAX,EAAtC;AACD;AAMD,OAAO,SAASC,QAAT,CAAkBC,gBAAlB,EAAyC;AAC9C;AAAA;AAAA;;AAAA;AAAA;;AAAA;;AAAA;AAAA;AAAA,aAaE,kBAAS;AACP,eAAO,MAAC,gBAAD,eAAsB,KAAKC,KAA3B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WAAP;AACD;AAfH;AAAA;AAAA;AAAA,wFACE,iBAA6BC,GAA7B,EAAmDD,KAAnD;AAAA;AAAA;AAAA;AAAA;AACUE,gBAAAA,IADV,GACmBF,KADnB,CACUE,IADV;;AAEE,oBAAI,CAACA,IAAD,IAAUA,IAAI,IAAIA,IAAI,CAACC,SAA3B,EAAuC;AACrCvB,kBAAAA,eAAe,CAACqB,GAAG,CAACG,GAAL,CAAf;AACD;;AACKC,gBAAAA,YALR,GAKuB;AAAEH,kBAAAA,IAAI,EAAJA;AAAF,iBALvB;;AAAA,qBAMMH,gBAAgB,CAACO,eANvB;AAAA;AAAA;AAAA;;AAAA,iDAOWP,gBAAgB,CAACO,eAAjB,CAAiCL,GAAjC,EAAsCI,YAAtC,CAPX;;AAAA;AAAA,iDASSA,YATT;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SADF;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA,IAAiC1B,SAAjC;AAiBD","sourcesContent":["import Router from \"next/router\";\nimport { NextPageContext } from \"next\";\nimport React, { Component } from \"react\";\nimport { AuthToken } from \"./auth-token\";\nimport { redirectToLogin } from \"./redirect\";\nimport nookies from \"nookies\";\nimport Cookies from \"js-cookie\";\n\nexport const TOKEN_STORAGE_NAME = \"app.authToken\";\n\nexport function login(token: string) {\n  nookies.set(null, TOKEN_STORAGE_NAME, token, {\n    maxAge: 7 * 24 * 60 * 60,\n    path: \"/\",\n  });\n  Router.push(\"/\");\n}\n\nexport function logout() {\n  Cookies.remove(TOKEN_STORAGE_NAME, { path: \"/\" });\n  // to support logging out from all windows\n  window.localStorage.setItem(\"logout\", Date.now().toString());\n}\n\nexport type AuthProps = {\n  auth: AuthToken;\n};\n\nexport function withAuth(WrappedComponent: any) {\n  return class AuthWrapper extends Component<AuthProps> {\n    static async getInitialProps(ctx: NextPageContext, props: AuthProps) {\n      const { auth } = props;\n      if (!auth || (auth && auth.isExpired)) {\n        redirectToLogin(ctx.res);\n      }\n      const initialProps = { auth };\n      if (WrappedComponent.getInitialProps) {\n        return WrappedComponent.getInitialProps(ctx, initialProps);\n      }\n      return initialProps;\n    }\n\n    render() {\n      return <WrappedComponent {...this.props} />;\n    }\n  };\n}\n"]},"metadata":{},"sourceType":"module"}